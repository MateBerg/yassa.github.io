<!DOCTYPE html>
<html>

<body style="margin:0; padding:0; overflow:hidden; background-color:#222222;">
    <canvas id="display"></canvas>
    <script src="https://cdn.jsdelivr.net/npm/pixi.js@7.2.4/dist/pixi.min.js"></script>

    <script>
        const equations = [
            '\\int_{a}^{b} f(x) dx = F(b) - F(a)', // Fundamental theorem of calculus
            '\\frac{d}{dx} (uv) = u\\frac{dv}{dx} + v\\frac{du}{dx}', // Product rule
            '\\frac{d}{dx} (\\frac{u}{v}) = \\frac{vu\' - uv\'}{v^2}', // Quotient rule
            '\\int e^{ax} dx = \\frac{1}{a} e^{ax}', // Integral of exponential
            '\\int a^x dx = \\frac{1}{\\ln a} a^x', // Integral of exponential with base a
            'n! = n \\times (n-1) \\times \\cdots \\times 2 \\times 1', // Factorial
            '\\binom{n}{k} = \\frac{n!}{k!(n-k)!}', // Binomial coefficient
            '\\int x^n dx = \\frac{x^{n+1}}{n+1}', // Power rule for integrals
            '\\frac{d}{dx} x^n = n x^{n-1}', // Power rule for derivatives
            '\\nabla \\cdot (\\nabla \\times \\vec{A}) = 0', // Vector calculus identity
            '\\nabla \\times (\\nabla f) = 0', // Vector calculus identity
            '\\Delta f = \\nabla \\cdot \\nabla f', // Laplacian in Cartesian coordinates
            '\\frac{d^2y}{dx^2} + ky = 0', // Simple harmonic oscillator
            '\\frac{d^2y}{dx^2} - k^2y = 0', // Wave equation
            '\\int_{-\\infty}^\\infty \\delta(x) dx = 1', // Property of Dirac delta function
            '\\int_{-\\infty}^\\infty \\delta(x-a) f(x) dx = f(a)', // Property of Dirac delta function
            '\\int_{-\\infty}^\\infty e^{-x^2} dx = \\sqrt{\\pi}', // Gaussian integral
            '\\frac{dP(X)}{dx} = f_X(x)', // Probability density function
            'E[X] = \\int_{-\\infty}^{\\infty} x f_X(x) dx', // Expected value
            'Var[X] = E[X^2] - (E[X])^2', // Variance
            'Cov[X,Y] = E[XY] - E[X]E[Y]', // Covariance
            '\\nabla^2 \\Phi = 4\\pi G \\rho', // Poisson's equation for gravitational potential
            '\\frac{d^2 x}{dt^2} = -\\frac{k}{m}x', // Simple harmonic motion
            '\\frac{dN}{dt} = rN(1 - \\frac{N}{K})', // Logistic population growth
            'x\' = Ax + Bu', // State-space representation of a system
            '\\frac{\\partial y}{\\partial t} = D\\frac{\\partial^2 y}{\\partial x^2}', // Heat equation
            '\\Delta S \\geq 0',
            '\\frac{\\partial u}{\\partial t} = \\alpha \\nabla^2 u',
            '\\nabla^2 u = 0',
            '\\int_{-\\infty}^\\infty \\hat f(\\xi)\\,e^{2 \\pi i \\xi x} \\,d\\xi',
            '\\Gamma(z) = \\int_0^\\infty t^{z-1}e^{-t} dt\\,.',
            '\\zeta(s) = \\sum_{n=1}^\\infty \\frac{1}{n^s}',
            '\\Phi(x,y) = \\int_\\Gamma \\frac{\\partial \\Phi}{\\partial n} ds',
            '\\left(\\frac{\\partial u}{\\partial n}\\right)_\\Gamma = \\int_\\Gamma g ds',
            '\\int_{a}^{b} f(x) dx = F(b) - F(a)', // Fundamental theorem of calculus
            '\\frac{d}{dx} (uv) = u\\frac{dv}{dx} + v\\frac{du}{dx}', // Product rule
            '\\frac{d}{dx} (\\frac{u}{v}) = \\frac{vu\' - uv\'}{v^2}', // Quotient rule
            '\\int e^{ax} dx = \\frac{1}{a} e^{ax}', // Integral of exponential
            '\\int a^x dx = \\frac{1}{\\ln a} a^x', // Integral of exponential with base a
            'n! = n \\times (n-1) \\times \\cdots \\times 2 \\times 1', // Factorial
            '\\binom{n}{k} = \\frac{n!}{k!(n-k)!}', // Binomial coefficient
            '\\int x^n dx = \\frac{x^{n+1}}{n+1}', // Power rule for integrals
            '\\frac{d}{dx} x^n = n x^{n-1}', // Power rule for derivatives
            '\\nabla \\cdot (\\nabla \\times \\vec{A}) = 0', // Vector calculus identity
            '\\nabla \\times (\\nabla f) = 0', // Vector calculus identity
            '\\Delta f = \\nabla \\cdot \\nabla f', // Laplacian in Cartesian coordinates
            '\\frac{d^2y}{dx^2} + ky = 0', // Simple harmonic oscillator
            '\\frac{d^2y}{dx^2} - k^2y = 0', // Wave equation
            '\\int_{-\\infty}^\\infty \\delta(x) dx = 1', // Property of Dirac delta function
            '\\int_{-\\infty}^\\infty \\delta(x-a) f(x) dx = f(a)', // Property of Dirac delta function
            '\\int_{-\\infty}^\\infty e^{-x^2} dx = \\sqrt{\\pi}', // Gaussian integral
            '\\frac{dP(X)}{dx} = f_X(x)', // Probability density function
            'E[X] = \\int_{-\\infty}^{\\infty} x f_X(x) dx', // Expected value
            'Var[X] = E[X^2] - (E[X])^2', // Variance
            'Cov[X,Y] = E[XY] - E[X]E[Y]', // Covariance
            '\\nabla^2 \\Phi = 4\\pi G \\rho', // Poisson's equation for gravitational potential
            '\\frac{d^2 x}{dt^2} = -\\frac{k}{m}x', // Simple harmonic motion
            '\\frac{dN}{dt} = rN(1 - \\frac{N}{K})', // Logistic population growth
            'x\' = Ax + Bu', // State-space representation of a system
            '\\frac{\\partial y}{\\partial t} = D\\frac{\\partial^2 y}{\\partial x^2}', // Heat equation
            '\\Delta S \\geq 0',
            '\\frac{\\partial u}{\\partial t} = \\alpha \\nabla^2 u',
            '\\nabla^2 u = 0',
            '\\int_{-\\infty}^\\infty \\hat f(\\xi)\\,e^{2 \\pi i \\xi x} \\,d\\xi',
            '\\Gamma(z) = \\int_0^\\infty t^{z-1}e^{-t} dt\\,.',
            '\\zeta(s) = \\sum_{n=1}^\\infty \\frac{1}{n^s}',
            '\\Phi(x,y) = \\int_\\Gamma \\frac{\\partial \\Phi}{\\partial n} ds',
            '\\left(\\frac{\\partial u}{\\partial n}\\right)_\\Gamma = \\int_\\Gamma g ds',
        ];
        const equationImages = [];
        const drops = [];

        const app = new PIXI.Application({
            view: document.getElementById('display'),
            width: window.innerWidth,
            height: window.innerHeight,
            resolution: window.devicePixelRatio,
            autoDensity: true,
            backgroundColor: 0x222222
        });

        class Drop {
            constructor(x, y, speed, texture) {
                this.sprite = new PIXI.Sprite(texture);
                this.sprite.x = x;
                this.sprite.y = y;
                this.sprite.scale.set(0.5);
                this.speed = speed;
                this.sprite.alpha = 0;
                this.sprite.anchor.set(0.5);
                app.stage.addChild(this.sprite);
                drops.push(this); // Add this instance to the drops array
            }

            resize() {
                this.sprite.x = Math.random() * app.screen.width;
                this.sprite.y = Math.random() * app.screen.height;
            }

            fall() {
                this.sprite.y += this.speed;
                this.sprite.alpha += 0.01;
                if (this.sprite.y > window.innerHeight + this.sprite.height) {
                    this.sprite.y = 0;
                    this.sprite.x = Math.random() * window.innerWidth;
                    this.sprite.alpha = 0;
                }
            }
        }

        window.MathJax = {
            jax: ["input/TeX", "output/SVG"],
            extensions: ["tex2jax.js", "MathMenu.js", "MathZoom.js"],
            showMathMenu: false,
            showProcessingMessages: false,
            messageStyle: "none",
            SVG: {
                useGlobalCache: false,
            },
            TeX: {
                extensions: ["AMSmath.js", "AMSsymbols.js", "autoload-all.js"]
            },
            AuthorInit: function () {
                MathJax.Hub.Register.StartupHook("End", function () {
                    var mj2img = function (texstring, callback) {
                        var input = texstring;
                        var wrapper = document.createElement("div");
                        wrapper.innerHTML = input;
                        var output = { svg: "", img: "" };
                        MathJax.Hub.Queue(["Typeset", MathJax.Hub, wrapper]);
                        MathJax.Hub.Queue(function () {
                            var mjOut = wrapper.getElementsByTagName("svg")[0];
                            mjOut.setAttribute("xmlns", "http://www.w3.org/2000/svg");

                            // Change the color to light gray
                            let colorElements = mjOut.querySelectorAll('[fill="currentColor"]');
                            colorElements.forEach((el) => {
                                el.setAttribute('fill', '#D3D3D3');
                            });

                            colorElements = mjOut.querySelectorAll('[stroke="currentColor"]');
                            colorElements.forEach((el) => {
                                el.setAttribute('stroke', '#D3D3D3');
                            });

                            // Change the size of SVG
                            let scaleFactor = 25; // Change this to adjust the overall size of the equations
                            let width = parseFloat(mjOut.getAttribute("width")) * scaleFactor;
                            let height = parseFloat(mjOut.getAttribute("height")) * scaleFactor;
                            mjOut.setAttribute("width", width + "px");
                            mjOut.setAttribute("height", height + "px");

                            output.svg = mjOut.outerHTML;

                            var image = new Image();
                            image.src = 'data:image/svg+xml;base64,' + window.btoa(unescape(encodeURIComponent(output.svg)));
                            image.onload = function () {
                                var canvas = document.createElement('canvas');
                                canvas.width = image.width;
                                canvas.height = image.height;
                                var context = canvas.getContext('2d');
                                context.drawImage(image, 0, 0);

                                output.img = canvas.toDataURL('image/png');
                                callback(output);
                            };
                        });
                    }
                    equations.forEach((equation, index) => {
                        mj2img("\\[" + equation + "\\]", function (output) {
                            let texture = PIXI.Texture.from(output.img);
                            equationImages.push(texture);
                            new Drop(Math.random() * window.innerWidth, Math.random() * window.innerHeight, (Math.random() + 0.5) * 5, texture);
                            if (index === 0) {
                                // Start the animation ticker as soon as the first equation is ready
                                app.ticker.add((delta) => {
                                    for (let drop of drops) {
                                        drop.fall();
                                    }
                                });
                            }
                        });
                    });
                });
            }
        };

        // setup() function 
        function setup() {
            app.ticker.add((delta) => {
                for (let drop of drops) {
                    drop.fall();
                }
            });
            window.addEventListener('resize', () => {
                app.renderer.resize(window.innerWidth, window.innerHeight);
                for (let drop of drops) {
                    drop.resize();
                }
            });
        }

        // Remaining part of MathJax loading
        (function (d, script) {
            script = d.createElement('script');
            script.type = 'text/javascript';
            script.async = true;
            script.onload = function () { };
            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js';
            d.getElementsByTagName('head')[0].appendChild(script);
        }(document));

    </script>
</body>

</html>